{% extends 'blog_base.html' %}

{% block title %}BLOG{% endblock %}

{% load static %}

{% block content %}
<!-- crumbs area start -->
<div class="crumbs-area">
    <div class="container">
        <div class="row">
            <div class="col-xs-12">
                <div class="crumbs-inner">
                    <h2>Blog</h2>
                    <ul>
                        <li><a href="{% url 'index' %}">Home</a></li>
                        <li><span>Blog</span></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- crumbs area end -->
<!-- blog area start -->
<section class="blog-post ptb--100" id="blog">
    <div class="container">
        <div class="row">
            <ul class="nav nav-pills" id="theme-tabs">
                <li role="presentation" class="active">
                    <a href="#전체" data-toggle="pill">전체</a>
                </li>
                {% for theme in themes %}
                <li role="presentation">
                    <a href="#{{theme.slug_name}}"data-toggle="pill">{{theme.name}}</a>
                </li>
                {% endfor %}
            </ul>
            <div class="tab-content">
                <div id="전체" class="tab-pane fade in active">
                    <hr>
                    {% for post in posts %}
                    <div class="col-md-4 col-sm-6 col-xs-12 col-6">
                        <div class="single-post">
                            <a href="{% url 'blog:member_blog_post_detail' username=post.user.username slug_title=post.slug_title %}">
                                {% if post.thumbnail %}
                                <img src="{{post.thumbnail.url}}" alt="blog image">
                                {% else %}
                                <img src="{% static 'img/blog/blog-post-img1.jpg' %}" alt="blog image">
                                {% endif %}
                            </a>
                            <div class="blog-meta">
                                <ul>
                                    <li><i class="fa fa-calendar"></i>{{post.created_date|date:"Y-m-d H:i"}}</li>
                                    <li>
                                        <i class="fa fa-user"></i>
                                        <a href="{% url 'blog:member_blog' post.user.username %}">{{post.user.username}}</a>
                                    </li>
                                </ul>
                            </div>
                            <h2>
                                <a href="{% url 'blog:member_blog_post_detail' username=post.user.username slug_title=post.slug_title %}">
                                    {{post.title}}
                                </a>
                            </h2>
                            <p>{{post.content|striptags}}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% for theme in themes %}
                <div id="{{theme.slug_name}}" class="tab-pane fade">
                  </div>
                {% endfor %}
              </div>
        </div>
    </div>
</section>
<!-- blog area end -->
<!-- pagination area start -->
<div class="pagination-area">
    <div class="container">
        <div class="pagination">
            <ul>
                <li><a href="#">OLDER POSTS</a></li>
                <li><a href="#">1</a></li>
                <li><a href="#">2</a></li>
                <li><span>3</span></li>
                <li><a href="#">4</a></li>
                <li><a href="#">NEWER POSTS</a></li>
            </ul>
        </div>
    </div>
</div>
<!-- pagination area end -->

<!-- Jquery JS-->
<script src="{% static 'js/jquery-3.2.0.min.js'%}"></script>

<script>
$('#theme-tabs a').click(function (e) {
    e.preventDefault();
    $(this).tab('show');

    current_theme_slug_name = $(this).attr('href').slice(1);

    if (current_theme_slug_name !== '전체'){
        $.get('/api/themes/' + current_theme_slug_name + '/posts')
        .done(function (data) {
            result = '';

            $.each(data, function(index, item) {
                var createdDate = '<li><i class="fa fa-calendar"></i>' + item.created_date + '</li>';
                var user = '<li><i class="fa fa-user"></i>' + item.user + '</li>';
                var ul = $('<ul></ul>').html(createdDate + user);
                var thumbnail = '';

                if (item.thumbnail) {
                    thumbnail += '<a href="#"><img src="' + item.thumbnail+ '" alt="blog image"></a>';
                } else {
                    thumbnail += '<a href="#"><img src="/static/img/blog/blog-post-img1.jpg" alt="blog image"></a>';
                }

                var postMeta = $('<div class="blog-meta"></div>').html(ul).prop('outerHTML');
                var title = '<h2><a href="#">' + item.title +'</a></h2>';
                var contentStripTags = item.content.replace(/(<([^>]+)>)/ig,"");
                var content = '<p>' + contentStripTags  + '</p>';

                var post = $('<div class="single-post"></div').html(thumbnail + postMeta + title + content);
                var div = $('<div class="col-md-4 col-sm-6 col-xs-12 col-6"></div>');

                result += div.html(post).prop('outerHTML');
            });

            $('#' + current_theme_slug_name).html('<hr>' + result);
        });
    }
});
</script>
{% endblock %}